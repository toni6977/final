<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞</title>
    <link href="assets/css/style.css" rel="stylesheet">
</head>
<body class="page-sidebar-fixed page-header-fixed">
    <div class="page-container">
        <div class="page-sidebar">
            <a class="logo-box" href="tests.html"><span style="color: white; font-size: 18px;">üéì –°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</span></a>
            <div class="page-sidebar-inner"><div class="page-sidebar-menu">
                <ul class="accordion-menu">
                    <li><a href="tests.html"><i class="menu-icon">üìö</i><span>–ú–æ–∏ —Ç–µ—Å—Ç—ã</span></a></li>
                    <li class="active"><a href="results.html"><i class="menu-icon">üìä</i><span>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</span></a></li>
                    <li><a href="#" onclick="logout()"><i class="menu-icon">üö™</i><span>–í—ã–π—Ç–∏</span></a></li>
                </ul>
            </div></div>
        </div>
        <div class="page-content">
            <div class="page-header"><nav class="navbar"><div id="userName"></div></nav></div>
            <div class="page-inner">
                <div class="page-title"><h1>–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞</h1></div>
                <div class="panel"><div class="panel-body" id="resultContent"></div></div>
            </div>
        </div>
    </div>
    <script src="data.js"></script>
    <script>
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (!currentUser) window.location.href = 'index.html';
        
        const resultId = parseInt(new URLSearchParams(window.location.search).get('id'));
        const allResults = JSON.parse(localStorage.getItem('testResults') || '[]');
        const result = allResults.find(r => r.id === resultId);
        const test = DB.tests.find(t => t.id === result.testId);
        
        const colorClass = result.percentage >= 70 ? 'success' : (result.percentage >= 50 ? 'warning' : 'danger');
        
        let html = `
            <div class="row">
                <div class="col-md-8">
                    <h2>${test.title}</h2>
                    <p><strong>–î–∞—Ç–∞:</strong> ${result.date}</p>
                </div>
                <div class="col-md-4 text-right">
                    <div class="alert alert-${colorClass}">
                        <h1 style="margin:0;font-size:48px;">${result.percentage}%</h1>
                        <p style="margin:0;">${result.score} / ${result.maxScore} –±–∞–ª–ª–æ–≤</p>
                    </div>
                </div>
            </div><hr><h3>–î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h3>
        `;
        
        result.details.forEach((d, i) => {
            html += `
                <div class="panel panel-${d.isCorrect?'success':'danger'}">
                    <div class="panel-heading">
                        <strong>–í–æ–ø—Ä–æ—Å ${i+1}</strong>
                        <span class="pull-right">
                            ${d.isCorrect ? `‚úì –ü—Ä–∞–≤–∏–ª—å–Ω–æ (+${d.points})` : '‚úó –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ'}
                        </span>
                    </div>
                    <div class="panel-body">
                        <p><strong>${d.question}</strong></p>
                        <p><strong>–í–∞—à –æ—Ç–≤–µ—Ç:</strong> <span class="label label-${d.isCorrect?'success':'danger'}">${d.userAnswer ? d.userAnswer.toUpperCase() : '–ù–µ –æ—Ç–≤–µ—á–µ–Ω–æ'}</span></p>
                        ${!d.isCorrect ? `<p><strong>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π:</strong> <span class="label label-success">${d.correctAnswer.toUpperCase()}</span></p>` : ''}
                    </div>
                </div>
            `;
        });
        
        html += `
            <div class="text-center" style="margin-top:30px;">
                <a href="tests.html" class="btn btn-primary">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ç–µ—Å—Ç–∞–º</a>
                <a href="results.html" class="btn btn-default">‚ò∞ –í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</a>
            </div>
        `;
        
        document.getElementById('resultContent').innerHTML = html;
        function logout() { localStorage.clear(); window.location.href = 'index.html'; }
    </script>
    <script src="protection.js"></script>
</body>
</html>
