<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞</title>
    <link href="assets/css/style.css" rel="stylesheet">
    <style>
        .panel-success .panel-heading { background: #dff0d8; color: #3c763d; }
        .panel-danger  .panel-heading { background: #f2dede; color: #a94442; }
        .label-success { background: #5cb85c; }
        .label-danger  { background: #d9534f; }
        .alert-success { background: #dff0d8; color: #3c763d; border-color: #d6e9c6; }
        .alert-warning { background: #fcf8e3; color: #8a6d3b; border-color: #faebcc; }
        .alert-danger  { background: #f2dede; color: #a94442; border-color: #ebccd1; }
        .result-score { font-size: 60px; font-weight: bold; margin: 0; }
    </style>
</head>
<body class="page-sidebar-fixed page-header-fixed">
    <div class="page-container">
        <!-- Sidebar -->
        <div class="page-sidebar">
            <a class="logo-box" href="tests.html">
                <span style="color: white; font-size: 18px;">üéì –°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</span>
            </a>
            <div class="page-sidebar-inner">
                <div class="page-sidebar-menu">
                    <ul class="accordion-menu">
                        <li><a href="tests.html"><i class="menu-icon">üìö</i><span>–ú–æ–∏ —Ç–µ—Å—Ç—ã</span></a></li>
                        <li class="active"><a href="results.html"><i class="menu-icon">üìä</i><span>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</span></a></li>
                        <li><a href="#" onclick="logout()"><i class="menu-icon">üö™</i><span>–í—ã–π—Ç–∏</span></a></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Content -->
        <div class="page-content">
            <div class="page-header">
                <nav class="navbar">
                    <div id="userName" style="font-size: 18px; font-weight: bold;"></div>
                </nav>
            </div>

            <div class="page-inner">
                <div class="page-title"><h1>–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞</h1></div>
                <div class="panel">
                    <div class="panel-body" id="resultContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="data.js"></script>
    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (!currentUser) window.location.href = 'index.html';
        document.getElementById('userName').textContent = currentUser.fullName;

        // –ü–æ–ª—É—á–∞–µ–º ID —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        const resultId = parseInt(new URLSearchParams(window.location.search).get('id'));
        const allResults = JSON.parse(localStorage.getItem('testResults') || '[]');
        const result = allResults.find(r => r.id === resultId);

        const container = document.getElementById('resultContent');

        if (!result) {
            container.innerHTML = `
                <div class="alert alert-danger text-center">
                    <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω</h3>
                    <p>–í–æ–∑–º–æ–∂–Ω–æ, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—ã–ª —É–¥–∞–ª—ë–Ω –∏–ª–∏ —Å—Å—ã–ª–∫–∞ –Ω–µ–≤–µ—Ä–Ω–∞—è.</p>
                    <a href="tests.html" class="btn btn-primary">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ç–µ—Å—Ç–∞–º</a>
                </div>
            `;
        } else {
            // –ü–æ–∏—Å–∫ —Ç–µ—Å—Ç–∞ –ø–æ –≤—Å–µ–º —Ä–∞–∑–¥–µ–ª–∞–º
            let selectedTest = null;
            for (const section of DB.sections) {
                const found = section.tests.find(t => t.id === result.testId);
                if (found) {
                    selectedTest = found;
                    break;
                }
            }
            if (!selectedTest) selectedTest = { title: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–µ—Å—Ç' };

            // –¶–≤–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
            const colorClass = result.percentage >= 70 ? 'success' :
                              (result.percentage >= 50 ? 'warning' : 'danger');

            let html = `
                <div class="row">
                    <div class="col-md-8">
                        <h2>${selectedTest.title}</h2>
                        <p><strong>–î–∞—Ç–∞:</strong> ${result.date}</p>
                        <p><strong>–í—Ä–µ–º—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è:</strong> ${result.durationUsed || '‚Äî'}</p>
                    </div>
                    <div class="col-md-4 text-right">
                        <div class="alert alert-${colorClass}" style="padding:25px;">
                            <div class="result-score">${result.percentage}%</div>
                            <p style="margin:10px 0 0; font-size:20px;">
                                ${result.score} / ${result.maxScore} –±–∞–ª–ª–æ–≤
                            </p>
                        </div>
                    </div>
                </div>
                <hr>
                <h3>–î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h3>
            `;

            result.details.forEach((d, i) => {
                const panelClass = d.isCorrect ? 'success' : 'danger';
                html += `
                    <div class="panel panel-${panelClass}">
                        <div class="panel-heading">
                            <strong>–í–æ–ø—Ä–æ—Å ${i+1}</strong>
                            <span class="pull-right">
                                ${d.isCorrect ? `‚úì –ü—Ä–∞–≤–∏–ª—å–Ω–æ (+${d.points})` : '‚úó –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ'}
                            </span>
                        </div>
                        <div class="panel-body">
                            <p><strong>${d.question}</strong></p>
                            <p><strong>–í–∞—à –æ—Ç–≤–µ—Ç:</strong> 
                                <span class="label label-${d.isCorrect?'success':'danger'}">
                                    ${d.userAnswer ? d.userAnswer.toUpperCase() : '–ù–µ –æ—Ç–≤–µ—á–µ–Ω–æ'}
                                </span>
                            </p>
                            ${!d.isCorrect ? `<p><strong>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π:</strong> <span class="label label-success">${d.correctAnswer.toUpperCase()}</span></p>` : ''}
                        </div>
                    </div>
                `;
            });

            html += `
                <div class="text-center" style="margin-top:40px;">
                    <a href="tests.html" class="btn btn-primary btn-lg">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ç–µ—Å—Ç–∞–º</a>
                    <a href="results.html" class="btn btn-default btn-lg" style="margin-left:15px;">‚ò∞ –í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</a>
                </div>
            `;

            container.innerHTML = html;
        }

        function logout() {
            localStorage.clear();
            window.location.href = 'index.html';
        }
    </script>
    <script src="protection.js"></script>
</body>
</html>
