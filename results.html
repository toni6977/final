<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–ò—Å—Ç–æ—Ä–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</title>
    <link href="assets/css/style.css" rel="stylesheet">
    <style>
        .progress { height: 25px; margin: 0; }
        .table th { background: #f8f9fa; }
        .label-success { background: #5cb85c; }
        .label-warning { background: #f0ad4e; }
        .label-danger  { background: #d9534f; }
    </style>
</head>
<body class="page-sidebar-fixed page-header-fixed">
    <div class="page-container">
        <!-- Sidebar -->
        <div class="page-sidebar">
            <a class="logo-box" href="tests.html">
                <span style="color: white; font-size: 18px;">üéì –°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</span>
            </a>
            <div class="page-sidebar-inner">
                <div class="page-sidebar-menu">
                    <ul class="accordion-menu">
                        <li><a href="tests.html"><i class="menu-icon">üìö</i><span>–ú–æ–∏ —Ç–µ—Å—Ç—ã</span></a></li>
                        <li class="active"><a href="results.html"><i class="menu-icon">üìä</i><span>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</span></a></li>
                        <li><a href="#" onclick="logout()"><i class="menu-icon">üö™</i><span>–í—ã–π—Ç–∏</span></a></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Content -->
        <div class="page-content">
            <div class="page-header">
                <nav class="navbar">
                    <div id="userName" style="font-size: 18px; font-weight: bold;"></div>
                </nav>
            </div>

            <div class="page-inner">
                <div class="page-title">
                    <h1>–ò—Å—Ç–æ—Ä–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h1>
                </div>
                <div id="resultsContent"></div>
            </div>
        </div>
    </div>

    <script src="data.js"></script>
    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (!currentUser) window.location.href = 'index.html';
        document.getElementById('userName').textContent = currentUser.fullName;

        // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const allResults = JSON.parse(localStorage.getItem('testResults') || '[]');
        const userResults = allResults
            .filter(r => r.userId === currentUser.id)
            .reverse(); // –Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É

        const container = document.getElementById('resultsContent');

        if (userResults.length === 0) {
            container.innerHTML = `
                <div class="alert alert-info text-center">
                    <h3>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤</h3>
                    <p>–ü—Ä–æ–π–¥–∏—Ç–µ –ø–µ—Ä–≤—ã–π —Ç–µ—Å—Ç, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.</p>
                    <a href="tests.html" class="btn btn-primary btn-lg">üìö –ü–µ—Ä–µ–π—Ç–∏ –∫ —Ç–µ—Å—Ç–∞–º</a>
                </div>
            `;
        } else {
            let html = `
                <div class="panel">
                    <div class="panel-body">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>–¢–µ—Å—Ç</th>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
                                    <th>–ü—Ä–æ—Ü–µ–Ω—Ç</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody>
            `;

            userResults.forEach(r => {
                // –ü–æ–∏—Å–∫ —Ç–µ—Å—Ç–∞ –ø–æ –≤—Å–µ–º —Ä–∞–∑–¥–µ–ª–∞–º
                let test = null;
                for (const section of DB.sections) {
                    const found = section.tests.find(t => t.id === r.testId);
                    if (found) {
                        test = found;
                        break;
                    }
                }
                if (!test) test = { title: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–µ—Å—Ç' };

                const colorClass = r.percentage >= 70 ? 'success' :
                                  (r.percentage >= 50 ? 'warning' : 'danger');

                html += `
                    <tr>
                        <td><strong>${test.title}</strong></td>
                        <td>${r.date}</td>
                        <td><span class="label label-${colorClass}">${r.score} / ${r.maxScore}</span></td>
                        <td>
                            <div class="progress">
                                <div class="progress-bar progress-bar-${colorClass}" 
                                     style="width: ${r.percentage}%">
                                    ${r.percentage}%
                                </div>
                            </div>
                        </td>
                        <td>
                            <a href="result.html?id=${r.id}" class="btn btn-sm btn-primary">üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä</a>
                        </td>
                    </tr>
                `;
            });

            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            container.innerHTML = html;
        }

        function logout() {
            localStorage.clear();
            window.location.href = 'index.html';
        }
    </script>
    <script src="protection.js"></script>
</body>
</html>
